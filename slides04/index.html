<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Core Java. Лекция 4: instanceof и Pattern Matching. Класс Object. Исключения. Строки</title><meta name="author" content="Иван Пономарёв, КУРС/МФТИ"><link rel="stylesheet" href="reveal.js-3.9.2/css/reset.css"><link rel="stylesheet" href="reveal.js-3.9.2/css/reveal.css"><link rel="stylesheet" href="white_course.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* listing block */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}
</style><link rel="stylesheet" href="./font-awesome-4.7.0/css/font-awesome.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
tex2jax: {
  inlineMath: [["\\(", "\\)"]],
  displayMath: [["\\[", "\\]"]],
  ignoreClass: "nostem|nolatexmath"
},
asciimath2jax: {
  delimiters: [["\\$", "\\$"]],
  ignoreClass: "nostem|noasciimath"
},
TeX: { equationNumbers: { autoNumber: "none" } }
});</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script><!--Printing and PDF exports--><script>var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? "reveal.js-3.9.2/css/print/pdf.css" : "reveal.js-3.9.2/css/print/paper.css";
document.getElementsByTagName( 'head' )[0].appendChild( link );</script></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Core Java. Лекция 4</h1><h2>instanceof и Pattern Matching. Класс Object. Исключения. Строки</h2><div class="preamble"><div class="paragraph"><p><a href="mailto:ponomarev@corchestra.ru">ponomarev@corchestra.ru</a></p></div>
<div class="paragraph"><p><span class="icon"><i class="fa fa-twitter fa-lg"></i></span> @inponomarev</p></div></div><p class="author"><small>Иван Пономарёв, КУРС/МФТИ</small></p></section>
<section id="_оператор_instanceof"><h2>Оператор instanceof</h2><div class="slide-content"><div class="imageblock"><img src="images/instanceof.png" alt="instanceof"></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #008080">C1</span> <span style="background-color: #f8f8f8">c1</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #008080">C2</span> <span style="background-color: #f8f8f8">c2</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #008080">C3</span> <span style="background-color: #f8f8f8">c3</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #008080">I1</span> <span style="background-color: #f8f8f8">i1</span><span style="color: #000000;font-weight: bold">;</span>

<span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #008080">A</span> <span style="color: #999988;font-style: italic">//  false, если x == null</span>
<span style="background-color: #f8f8f8">c1</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #008080">С2</span> <span style="color: #999988;font-style: italic">// true или false</span>
<span style="background-color: #f8f8f8">i1</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #008080">C2</span> <span style="color: #999988;font-style: italic">// true или false</span>
<span style="background-color: #f8f8f8">c2</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #008080">C1</span> <span style="color: #999988;font-style: italic">// всегда возвращает true</span>
<span style="background-color: #f8f8f8">с3</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #008080">C2</span> <span style="color: #999988;font-style: italic">// не скомпилируется</span></code></pre></div></div></div></section>
<section id="_приведение_типов_в_эпоху_до_pattern_matching_java_14"><h2>Приведение типов в эпоху до Pattern Matching (Java 14+)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">Person</span> <span style="background-color: #f8f8f8">p</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.;</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">p</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #445588;font-weight: bold">Student</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #999988;font-style: italic">//если не защитить instanceof, возможен ClassCastException</span>
    <span style="color: #445588;font-weight: bold">Student</span> <span style="background-color: #f8f8f8">s</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Student</span><span style="color: #000000;font-weight: bold">)</span> <span style="background-color: #f8f8f8">p</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_pattern_matching_for_instanceof_java_14_jep305"><h2>Pattern Matching for instanceof (Java 14+, JEP305)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">Person</span> <span style="background-color: #f8f8f8">p</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.;</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">p</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #445588;font-weight: bold">Student</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
   <span style="color: #999988;font-style: italic">//здесь доступна переменная Student s</span>
    <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="color: #000000;font-weight: bold">{</span>
   <span style="color: #999988;font-style: italic">//здесь недоступна переменная Student s</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #999988;font-style: italic">//Скомпилируется</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">obj</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">s</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">length</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
   <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
   <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">contains</span><span style="color: #000000;font-weight: bold">(..)</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #999988;font-style: italic">//НЕ скомпилируется</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">obj</span> <span style="color: #000000;font-weight: bold">instanceof</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">s</span> <span style="color: #000000;font-weight: bold">||</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">length</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{...}</span></code></pre></div></div></div></section>
<section id="_pattern_matching_for_switch_java_21"><h2>Pattern matching for switch (Java 21+)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Expr</span> <span style="background-color: #f8f8f8">expr</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">return</span> <span style="color: #990000;font-weight: bold">switch</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">expr</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #999988;font-style: italic">//Не скомпилируется, если мы забудем что-то из реализаций Expr!</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Literal</span> <span style="background-color: #f8f8f8">l</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="background-color: #f8f8f8">l</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">value</span><span style="color: #000000;font-weight: bold">();</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Divide</span> <span style="background-color: #f8f8f8">d</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">d</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">left</span><span style="color: #000000;font-weight: bold">())</span> <span style="color: #000000;font-weight: bold">/</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">d</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">right</span><span style="color: #000000;font-weight: bold">());</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Multiply</span> <span style="background-color: #f8f8f8">m</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">m</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">left</span><span style="color: #000000;font-weight: bold">())</span> <span style="color: #000000;font-weight: bold">*</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">m</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">right</span><span style="color: #000000;font-weight: bold">());</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Add</span> <span style="background-color: #f8f8f8">a</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">left</span><span style="color: #000000;font-weight: bold">())</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">right</span><span style="color: #000000;font-weight: bold">());</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Subtract</span> <span style="background-color: #f8f8f8">s</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">left</span><span style="color: #000000;font-weight: bold">())</span> <span style="color: #000000;font-weight: bold">-</span> <span style="background-color: #f8f8f8">calculate</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">right</span><span style="color: #000000;font-weight: bold">());</span>
  <span style="color: #000000;font-weight: bold">};</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_when_guards_for_pattern_matching"><h2><code>when</code> guards for pattern matching</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">describe</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Object</span> <span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">return</span> <span style="color: #990000;font-weight: bold">switch</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #000000;font-weight: bold">null</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"got null"</span><span style="color: #000000;font-weight: bold">;</span>

    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">s</span> <span style="background-color: #f8f8f8">when</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">isBlank</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"blank string"</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">s</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"string("</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">length</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">+</span> <span style="color: #d14">" chars)"</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Integer</span> <span style="background-color: #f8f8f8">i</span> <span style="background-color: #f8f8f8">when</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="color: #009999">0</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"negative int "</span> <span style="color: #000000;font-weight: bold">+</span> <span style="color: #000000;font-weight: bold">(-</span><span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">);</span>
    <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Integer</span> <span style="background-color: #f8f8f8">i</span>            <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"int "</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">;</span>

    <span style="color: #000000;font-weight: bold">default</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"something else"</span><span style="color: #000000;font-weight: bold">;</span>
  <span style="color: #000000;font-weight: bold">};</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_предупреждение_про_pattern_matching"><h2>Предупреждение про pattern matching</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pattern matching&#8201;&#8212;&#8201;это красивая возможность языка, но у неё ограничена область применения: Visitor Pattern, в основном нужный при разработке компиляторов / интерпретаторов формальных языков.</p></li><li><p>Не надо использовать pattern matching там, где достаточно обычного полиморфизма</p></li></ul></div></div></section>
<section id="_полиморфизм_vs_pattern_matching"><h2>Полиморфизм vs Pattern matching</h2><div class="slide-content"><div class="ulist"><ul><li><p>Полиморфизм: поведение внутри класса</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="background-color: #f8f8f8">sealed</span> <span style="color: #000000;font-weight: bold">interface</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="background-color: #f8f8f8">permits</span> <span style="color: #445588;font-weight: bold">Dog</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">Cat</span> <span style="color: #000000;font-weight: bold">{</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">speak</span><span style="color: #000000;font-weight: bold">();</span> <span style="color: #000000;font-weight: bold">}</span>

<span style="color: #000000;font-weight: bold">final</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Dog</span> <span style="color: #000000;font-weight: bold">implements</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">speak</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="color: #d14">"woof"</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">final</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Cat</span> <span style="color: #000000;font-weight: bold">implements</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">speak</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="color: #d14">"meow"</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">speak</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Animal</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">speak</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_полиморфизм_vs_pattern_matching_2"><h2>Полиморфизм vs Pattern matching</h2><div class="slide-content"><div class="ulist"><ul><li><p>Pattern matching: поведение вынесено из класса</p></li></ul></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="background-color: #f8f8f8">sealed</span> <span style="color: #000000;font-weight: bold">interface</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="background-color: #f8f8f8">permits</span> <span style="color: #445588;font-weight: bold">Dog</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">Cat</span> <span style="color: #000000;font-weight: bold">{</span> <span style="color: #000000;font-weight: bold">}</span>

<span style="color: #000000;font-weight: bold">final</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Dog</span> <span style="color: #000000;font-weight: bold">implements</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="color: #000000;font-weight: bold">{</span>

<span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">final</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Cat</span> <span style="color: #000000;font-weight: bold">implements</span> <span style="color: #445588;font-weight: bold">Animal</span> <span style="color: #000000;font-weight: bold">{</span>

<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">speak</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Animal</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="color: #990000;font-weight: bold">switch</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
        <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Dog</span> <span style="background-color: #f8f8f8">d</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"woof"</span><span style="color: #000000;font-weight: bold">;</span>
        <span style="color: #000000;font-weight: bold">case</span> <span style="color: #445588;font-weight: bold">Cat</span> <span style="background-color: #f8f8f8">c</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #d14">"meow"</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">};</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_object_the_cosmic_superclass"><h2>Object: the Cosmic Superclass</h2><div class="slide-content"><div class="ulist"><ul><li><p>Любой класс в Java является наследником <code>Object</code></p></li><li><p>Писать <code>class Employee extends Object</code> не надо</p></li><li><p>В этом классе определены важные методы:</p><div class="ulist"><ul><li><p><code>equals</code>, <code>hashCode</code>, <code>toString</code>&#8201;&#8212;&#8201;рассмотрим прямо сейчас</p></li><li><p><code>notify</code>, <code>notifyAll</code>, <code>wait</code>&#8201;&#8212;&#8201;рассмотрим в лекциях по Concurrency</p></li><li><p><code>getClass</code>&#8201;&#8212;&#8201;в лекции про Reflection API</p></li><li><p><code>clone</code>, <code>finalize</code>&#8201;&#8212;&#8201;не обращайте на них внимания, OK?</p></li></ul></div></li></ul></div></div></section>
<section id="_equals_и_hashcode"><h2><code>equals()</code> и <code>hashCode()</code></h2><div class="slide-content"><div class="ulist"><ul><li><p><code>boolean equals(Object other)</code> возвращает <code>true</code> т. и т. т., когда внутреннее состояние совпадает</p></li><li><p><code>int hashCode()</code> возвращает целое значение, которое обязано совпадать для объектов с одинаковым внутренним состоянием</p></li><li><p>Это нужно для хеш-таблиц (и, пожалуй, является <em>протекшей абстракцией</em>)</p></li></ul></div></div></section>
<section id="_формальный_контракт_equals"><h2>Формальный контракт <code>equals</code></h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Рефлексивность:<br>
\(\forall x \ne \mathrm{null} (x.equals(x))\)</p></li><li><p>Симметричность:<br>
\(\forall x \ne \mathrm{null} \, \forall y \ne \mathrm{null} (x.equals(y) \iff y.equals(x))\)</p></li><li><p>Транзитивность:<br>
\(\forall x \ne \mathrm{null} \, \forall y \ne \mathrm{null} \, \forall z \ne \mathrm{null} (x.equals(y) \&amp; y.equals(z) \Rightarrow x.equals(z))\)</p></li><li><p>Консистентность: если сравниваемые объекты не изменялись, повторный вызов <code>equals</code> должен возвращать одно и то же значение.</p></li><li><p>\(\forall x \ne \mathrm{null} (x.equals(\mathrm{null}) = \mathrm{false})\)</p></li></ol></div></div></section>
<section id="_формальный_контракт_hashcode"><h2>Формальный контракт <code>hashCode</code></h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Консистентность: если объект не изменялся, повторный вызов <code>hashCode</code> должен возвращать одно и то же значение (но не обязательно одно и то же между разными запусками приложения)</p></li><li><p>Связь с <code>equals</code>:<br>
\(\forall x \forall y (x.equals(y) \Rightarrow x.hashCode() = y.hashCode())\)</p></li><li><p>Хотя<br>
\(x.hashCode() = y.hashCode() \Rightarrow x.equals(y)\)<br>
и не обязательно, но желательно для большинства случаев.</p></li></ol></div></div></section>
<section id="_выводы"><h2>Выводы</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li><p>Переопределять <code>equals</code> и <code>hashCode</code> нужно только вместе и согласованно, чтобы выполнить контракт \(x.equals(y) \Rightarrow x.hashCode() = y.hashCode()\)</p></li><li><p>Грамотно реализовать <code>equals</code> и <code>hashCode</code> трудно, но, к счастью, самостоятельно это делать не нужно.</p></li><li><p>Для тестирования есть специальная библиотка <a href="https://jqno.nl/equalsverifier/">EqualsVerifier</a>.</p></li><li><p>Для генерации <code>equals</code> и <code>hashCode</code> можно использовать возможности IDE или библиотеки <a href="https://projectlombok.org/">Lombok</a>.</p></li></ol></div></div></section>
<section id="_генерация_equals_и_hashcode"><h2>Генерация <code>equals</code> и <code>hashCode</code></h2><div class="slide-content"><div class="imageblock"><img src="images/generateequals.png" alt="generateequals" width="50%"></div></div></section>
<section id="_генерация_equals_и_hashcode_2"><h2>Генерация <code>equals</code> и <code>hashCode</code></h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Person</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">private</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">private</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">age</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #3c5d5d;font-weight: bold">@Override</span>
    <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">equals</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Object</span> <span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
       <span style="color: #999988;font-style: italic">// никогда, НИКОГДА не пишите это сами</span>
        <span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">this</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">return</span> <span style="color: #000000;font-weight: bold">true</span><span style="color: #000000;font-weight: bold">;</span>
        <span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">o</span> <span style="color: #000000;font-weight: bold">==</span> <span style="color: #000000;font-weight: bold">null</span> <span style="color: #000000;font-weight: bold">||</span> <span style="background-color: #f8f8f8">getClass</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">getClass</span><span style="color: #000000;font-weight: bold">())</span> <span style="color: #000000;font-weight: bold">return</span> <span style="color: #000000;font-weight: bold">false</span><span style="color: #000000;font-weight: bold">;</span>
        <span style="color: #445588;font-weight: bold">Person</span> <span style="background-color: #f8f8f8">person</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Person</span><span style="color: #000000;font-weight: bold">)</span> <span style="background-color: #f8f8f8">o</span><span style="color: #000000;font-weight: bold">;</span>
        <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">age</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">person</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">age</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span>
                <span style="color: #445588;font-weight: bold">Objects</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">equals</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">person</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">name</span><span style="color: #000000;font-weight: bold">);</span>
    <span style="color: #000000;font-weight: bold">}</span>

    <span style="color: #3c5d5d;font-weight: bold">@Override</span>
    <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">hashCode</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span>
        <span style="color: #000000;font-weight: bold">return</span> <span style="color: #445588;font-weight: bold">Objects</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">hash</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">age</span><span style="color: #000000;font-weight: bold">);</span>
    <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_или_если_у_нас_lombok"><h2>Или, если у нас Lombok</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">import</span> <span style="color: #555555">lombok.EqualsAndHashCode</span><span style="color: #000000;font-weight: bold">;</span>

<span style="color: #3c5d5d;font-weight: bold">@EqualsAndHashCode</span>
<span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Person</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">private</span>  <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">age</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">private</span>  <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_переопределение_tostring"><h2>Переопределение toString</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Person</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">private</span> <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">private</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">age</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
    <span style="color: #3c5d5d;font-weight: bold">@Override</span>
    <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">toString</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span>
        <span style="color: #000000;font-weight: bold">return</span> <span style="color: #d14">"Person{"</span> <span style="color: #000000;font-weight: bold">+</span>
                <span style="color: #d14">"name='"</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">name</span> <span style="color: #000000;font-weight: bold">+</span> <span style="color: #d14">'\''</span> <span style="color: #000000;font-weight: bold">+</span>
                <span style="color: #d14">", age="</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">age</span> <span style="color: #000000;font-weight: bold">+</span>
                <span style="color: #d14">'}'</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #445588;font-weight: bold">Person</span> <span style="background-color: #f8f8f8">person</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">println</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">person</span><span style="color: #000000;font-weight: bold">);</span></code></pre></div></div></div></section>
<section id="_или_если_у_нас_lombok_2"><h2>Или, если у нас Lombok</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">import</span> <span style="color: #555555">lombok.ToString</span><span style="color: #000000;font-weight: bold">;</span>

<span style="color: #3c5d5d;font-weight: bold">@ToString</span>
<span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Person</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">private</span>  <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">age</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">private</span>  <span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_полный_обвес_класса"><h2>Полный «обвес» класса</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Point</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">private</span> <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">;</span>
  <span style="color: #000000;font-weight: bold">private</span> <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">y</span><span style="color: #000000;font-weight: bold">;</span>

  <span style="color: #999988;font-style: italic">/*Подождите! Нам нужны:
   * конструктор
   * getX() и getY()
   * equals и hashCode
   * toString
   * 40 строчек кода из ничего!
   */</span>

  <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">double</span> <span style="color: #990000;font-weight: bold">distance</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Point</span> <span style="background-color: #f8f8f8">other</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">...</span>
  <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_или_если_у_нас_lombok_3"><h2>Или, если у нас Lombok</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">import</span> <span style="color: #555555">lombok.Data</span><span style="color: #000000;font-weight: bold">;</span>

<span style="color: #3c5d5d;font-weight: bold">@Data</span>
<span style="color: #000000;font-weight: bold">public</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Point</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">private</span> <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">;</span>
  <span style="color: #000000;font-weight: bold">private</span> <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">y</span><span style="color: #000000;font-weight: bold">;</span>
  <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">double</span> <span style="color: #990000;font-weight: bold">distance</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Point</span> <span style="background-color: #f8f8f8">other</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">...</span>
  <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_или_если_у_нас_java_14"><h2>Или, если у нас Java 14+</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="background-color: #f8f8f8">record</span> <span style="color: #990000;font-weight: bold">Point</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">y</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>

<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div>
<div class="ulist"><ul><li><p><code>equals</code>, <code>hashCode</code> и <code>toString</code> создаются неявно и автоматически</p></li></ul></div></div></section>
<section id="_исключительные_ситуации"><h2>Исключительные ситуации</h2><div class="slide-content"><div class="ulist"><ul><li><p>Программные ошибки (баги): null pointer dereference, выход за границы массива, некорректное приведение типов, деление на ноль и т. п.</p></li><li><p>Некорректные входные данные</p></li><li><p>Железо и сеть: невозможность открыть файл, нехватка памяти / места на диске и т. п.</p></li></ul></div>
<div class="paragraph"><p>Исключение&#8201;&#8212;&#8201;способ <em>недвусмысленно</em> сообщить о том, что вызов функции завершился неудачей (в отличие от return codes и т. п.).</p></div></div></section>
<section id="_иерархия_классов_исключений"><h2>Иерархия классов исключений</h2><div class="slide-content"><div class="imageblock"><img src="images/exceptionclasses.png" alt="exceptionclasses"></div></div></section>
<section id="_что_делаем"><h2>Что делаем?</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>Error</code> и наследники&#8201;&#8212;&#8201;не обрабатываем (что-то катастрофическое случилось).</p></li><li><p><code>RuntimeException</code> и наследники&#8201;&#8212;&#8201;их быть не должно (по идее, но не всё так просто).</p></li><li><p>Checked exceptions&#8201;&#8212;&#8201;их обрабатываем.</p></li></ul></div></div></section>
<section id="_декларирование_checked_исключений"><h2>Декларирование checked-исключений</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">public</span> <span style="color: #990000;font-weight: bold">FileInputStream</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">throws</span> <span style="color: #445588;font-weight: bold">FileNotFoundException</span><span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_декларирование_более_чем_одного_исключения"><h2>Декларирование более чем одного исключения</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">MyAnimation</span> <span style="color: #000000;font-weight: bold">{</span>
<span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
  <span style="color: #000000;font-weight: bold">public</span> <span style="color: #445588;font-weight: bold">Image</span> <span style="color: #990000;font-weight: bold">loadImage</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">s</span><span style="color: #000000;font-weight: bold">)</span>
    <span style="color: #000000;font-weight: bold">throws</span> <span style="color: #445588;font-weight: bold">FileNotFoundException</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">EOFException</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
  <span style="color: #000000;font-weight: bold">}</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div>
<div class="ulist"><ul><li><p>Не надо декларировать unchecked exceptions</p></li><li><p>Не надо декларировать исключения, если одно&#8201;&#8212;&#8201;подтип другого</p></li><li><p>Правда жизни: вам поможет IDE</p></li></ul></div></div></section>
<section id="_выбрасывание_исключений"><h2>Выбрасывание исключений</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">throw</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">EOFException</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div>
<div class="paragraph"><p>(Если мы выбрасываем checked exception, компилятор позволит это сделать либо если оно задекларировано, либо если оно обрабатывается в самом методе.)</p></div></div></section>
<section id="_выбрасывание_исключений_2"><h2>Выбрасывание исключений</h2><div class="slide-content"><div class="paragraph"><p><em>Не следует</em> выбрасывать явно</p></div>
<div class="ulist"><ul><li><p><code>Exception</code></p></li><li><p><code>RuntimeException</code></p></li><li><p><code>Throwable</code></p></li><li><p><code>Error</code></p></li></ul></div>
<div class="paragraph"><p>(J. Bloch, Effective Java, Item 72)</p></div></div></section>
<section id="_откуда_наследовать_своё_собственное_исключение_вот_в_чём_вопрос"><h2>Откуда наследовать своё собственное исключение? Вот в чём вопрос</h2><div class="slide-content"><div class="ulist"><ul><li><p>Если наследовать от Exception&#8201;&#8212;&#8201;надо быть готовым, что его придётся декларировать или ловить всюду. Хорошо это или плохо?</p></li><li><p>Можно унаследоваться от RuntimeException. И забыть его поймать.</p></li><li><p>В эпоху лямбд и стримов checked exceptions это скорее головная боль.</p></li><li><p>Споры не прекращаются.</p></li></ul></div></div></section>
<section id="_как_поймать_исключение_try_catch_блок"><h2>Как поймать исключение: try-catch блок</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// . . . code . . .</span>
  <span style="color: #999988;font-style: italic">// . . . more code . . .</span>
  <span style="color: #999988;font-style: italic">// . . . more code . . .</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">ExceptionType</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// handler for this type of exception</span>
  <span style="color: #999988;font-style: italic">// use e object to extract the data!</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_как_поймать_несколько_типов_исключений"><h2>Как поймать несколько типов исключений</h2><div class="slide-content"><div class="imageblock"><img src="images/iomultiple.png" alt="iomultiple"></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//code that might throw exceptions</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">FileNotFoundException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//emergency action for missing files</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">UnknownHostException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// emergency action for unknown hosts</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">IOException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// emergency action for all other I/O problems</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_try_multicatch"><h2>try-multicatch</h2><div class="slide-content"><div class="imageblock"><img src="images/iomultiple.png" alt="iomultiple"></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//code that might throw exceptions</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">FileNotFoundException</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #445588;font-weight: bold">UnknownHostException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//emergency action for missing files or unknown hosts</span>

  <span style="color: #999988;font-style: italic">//e type is the most specific common supertype</span>
  <span style="color: #999988;font-style: italic">//of the throwable types</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_перевыбрасывание_исключений_с_умной_проверкой_типов"><h2>Перевыбрасывание исключений (с умной проверкой типов)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">throws</span> <span style="color: #445588;font-weight: bold">SQLException</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>

<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//доступ к БД -- может выбросить SQLException</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Exception</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="background-color: #f8f8f8">logger</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">log</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">level</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">message</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">);</span>
  <span style="color: #999988;font-style: italic">//хотя Exception есть тип более широкий,</span>
  <span style="color: #999988;font-style: italic">//чем задекларирован в методе, компилятор поймёт,</span>
  <span style="color: #999988;font-style: italic">//что всё ок</span>
  <span style="color: #000000;font-weight: bold">throw</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_обёртывание_исключений"><h2>Обёртывание исключений</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">throws</span> <span style="color: #445588;font-weight: bold">ServletException</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>

<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">//доступ к БД -- может выбросить SQLException</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">SQLException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #445588;font-weight: bold">ServletException</span> <span style="background-color: #f8f8f8">se</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">ServletException</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"database error"</span><span style="color: #000000;font-weight: bold">);</span>
  <span style="color: #999988;font-style: italic">//сохраняем информацию о первопричине</span>
  <span style="background-color: #f8f8f8">se</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">initCause</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">);</span>
  <span style="color: #000000;font-weight: bold">throw</span> <span style="background-color: #f8f8f8">se</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_переопределение_методов_с_исключениями"><h2>Переопределение методов с исключениями</h2><div class="slide-content"><div class="imageblock"><img src="images/overriding.png" alt="overriding"></div>
<div class="ulist"><ul><li><p>Исключение может быть того же типа или субтипа</p></li><li><p>Не возбраняется, если его не будет вообще</p></li></ul></div></div></section>
<section id="_стандартные_типы_переиспользуемых_unchecked_exceptions"><h2>Стандартные типы переиспользуемых unchecked-exceptions</h2><div class="slide-content"><div class="paragraph"><p>J.&#160;Bloch 'Effective Java', Item 72:</p></div>
<table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:30%"><col style="width:70%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>InvalidArgumentException</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>неправильный, ненулевой параметр метода</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>InvalidStateException</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>внутреннее состояние объекта не подходит для запуска метода</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>NullPointerException</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>передан <code>null</code> в метод, не ожидающий <code>null</code> в качестве параметра</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><code>IndexOutOfBoundsException</code></p></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Индексный параметр выходит за допустимый диапазон</p></div></div></td></tr></table></div></section>
<section id="_вам_будет_очень_хотеться_сделать_так"><h2>Вам будет очень хотеться сделать так&#8230;&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
 <span style="color: #000000;font-weight: bold">...</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Exception</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
 <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">printStackTrace</span><span style="color: #000000;font-weight: bold">();</span>
 <span style="color: #999988;font-style: italic">//И компилятор счастлив!</span>
 <span style="color: #999988;font-style: italic">//(но коллега во время код-ревью -- нет)</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div>
<div class="paragraph"><p>&#8230;&#8203;<strong>но так делать не надо!</strong></p></div></div></section>
<section id="_если_не_понятно_что_делать_с_исключением"><h2>Если не понятно, что делать с исключением</h2><div class="slide-content"><div class="ulist"><ul><li><p>Задекларируйте checked exception в методе</p></li><li><p>Оберните с помощью <code>initCause</code> или параметра конструктора</p><div class="ulist"><ul><li><p>в задекларированный checked exception</p></li><li><p>в unchecked exception (<code>InvalidStateException</code>, например)</p></li></ul></div></li><li><p>Лучше не надо: Lobmok&#8217;s <code>@SneakyThrows</code> (самая спорная фича Lombok)</p></li></ul></div></div></section>
<section id="_общее_правило"><h2>Общее правило</h2><div class="slide-content"><div class="ulist"><ul><li><p><em>Throw early, catch late.</em></p></li><li><p>Не откладывайте выбрасывание исключения, как только стала ясна причина ошибки.</p></li><li><p>Не спешите обрабатывать исключение, пока вам не стал полностью ясен механизм обработки.</p></li></ul></div></div></section>
<section id="_finally_блок"><h2>finally-блок</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">InputStream</span> <span style="background-color: #f8f8f8">in</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">FileInputStream</span><span style="color: #000000;font-weight: bold">(.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.);</span>
<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// исключение может возникнуть здесь</span>
  <span style="background-color: #f8f8f8">code</span> <span style="background-color: #f8f8f8">that</span> <span style="background-color: #f8f8f8">might</span> <span style="color: #000000;font-weight: bold">throw</span> <span style="background-color: #f8f8f8">exceptions</span>
  <span style="color: #999988;font-style: italic">// и даже возврат из метода вызовет блок finally!</span>
  <span style="color: #000000;font-weight: bold">if</span> <span style="color: #000000;font-weight: bold">(...)</span>
    <span style="color: #000000;font-weight: bold">return</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">IOException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// бывает, исключение возникает во время</span>
  <span style="color: #999988;font-style: italic">// обработки исключений</span>
  <span style="background-color: #f8f8f8">show</span> <span style="background-color: #f8f8f8">error</span> <span style="background-color: #f8f8f8">message</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">finally</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #999988;font-style: italic">// в любом случае сработает finally-блок!</span>
  <span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">close</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_беда_с_finally_block"><h2>Беда с finally-block</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">...</span><span style="color: #008080">throws</span> <span style="color: #445588;font-weight: bold">IOException</span><span style="color: #000000;font-weight: bold">...</span>
<span style="color: #999988;font-style: italic">//Один ресурс</span>

<span style="color: #445588;font-weight: bold">BufferedReader</span> <span style="background-color: #f8f8f8">br</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">BufferedReader</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">FileReader</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">path</span><span style="color: #000000;font-weight: bold">));</span>

<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span><span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">br</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">readLine</span><span style="color: #000000;font-weight: bold">();}</span>

<span style="color: #000000;font-weight: bold">finally</span> <span style="color: #000000;font-weight: bold">{</span><span style="background-color: #f8f8f8">br</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">close</span><span style="color: #000000;font-weight: bold">();}</span></code></pre></div></div></div></section>
<section id="_беда_с_finally_block_2"><h2>Беда с finally-block</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">...</span><span style="color: #008080">throws</span> <span style="color: #445588;font-weight: bold">IOException</span><span style="color: #000000;font-weight: bold">...</span>
<span style="color: #999988;font-style: italic">//Два ресурса</span>

<span style="color: #445588;font-weight: bold">InputStream</span> <span style="background-color: #f8f8f8">in</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">FileInputStream</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">src</span><span style="color: #000000;font-weight: bold">);</span>
<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #445588;font-weight: bold">OutputStream</span> <span style="background-color: #f8f8f8">out</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">FileOutputStream</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">dst</span><span style="color: #000000;font-weight: bold">);</span>
  <span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #445588;font-weight: bold">byte</span><span style="color: #000000;font-weight: bold">[]</span> <span style="background-color: #f8f8f8">buf</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">byte</span><span style="color: #000000;font-weight: bold">[</span><span style="color: #008080">BUFFER_SIZE</span><span style="color: #000000;font-weight: bold">];</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span><span style="color: #000000;font-weight: bold">;</span>
    <span style="color: #000000;font-weight: bold">while</span> <span style="color: #000000;font-weight: bold">((</span><span style="background-color: #f8f8f8">n</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">read</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">buf</span><span style="color: #000000;font-weight: bold">))</span> <span style="color: #000000;font-weight: bold">&gt;=</span> <span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">)</span><span style="background-color: #f8f8f8">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">write</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">buf</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">n</span><span style="color: #000000;font-weight: bold">);}</span>
  <span style="color: #000000;font-weight: bold">finally</span> <span style="color: #000000;font-weight: bold">{</span><span style="background-color: #f8f8f8">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">close</span><span style="color: #000000;font-weight: bold">();}}</span>
<span style="color: #000000;font-weight: bold">finally</span> <span style="color: #000000;font-weight: bold">{</span><span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">close</span><span style="color: #000000;font-weight: bold">();}</span></code></pre></div></div></div></section>
<section id="_try_with_resources_блок"><h2>try-with-resources-блок</h2><div class="slide-content"><div class="paragraph"><p>Общая схема</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Resource</span> <span style="background-color: #f8f8f8">res</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="background-color: #f8f8f8">work</span> <span style="background-color: #f8f8f8">with</span> <span style="background-color: #f8f8f8">res</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div>
<div class="paragraph"><p>Пример:</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Scanner</span> <span style="background-color: #f8f8f8">in</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">Scanner</span><span style="color: #000000;font-weight: bold">(</span>
    <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">FileInputStream</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/usr/share/dict/words"</span><span style="color: #000000;font-weight: bold">)),</span> <span style="color: #d14">"UTF-8"</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">while</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">hasNext</span><span style="color: #000000;font-weight: bold">())</span>
    <span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">println</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">next</span><span style="color: #000000;font-weight: bold">());</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_множество_ресурсов"><h2>Множество ресурсов</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Scanner</span> <span style="background-color: #f8f8f8">in</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">Scanner</span><span style="color: #000000;font-weight: bold">(</span>
     <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">FileInputStream</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"/usr/share/dict/words"</span><span style="color: #000000;font-weight: bold">),</span> <span style="color: #d14">"UTF-8"</span><span style="color: #000000;font-weight: bold">);</span>
     <span style="color: #445588;font-weight: bold">PrintWriter</span> <span style="background-color: #f8f8f8">out</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">PrintWriter</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"out.txt"</span><span style="color: #000000;font-weight: bold">))</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">while</span> <span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">hasNext</span><span style="color: #000000;font-weight: bold">())</span>
    <span style="background-color: #f8f8f8">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">println</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">in</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">next</span><span style="color: #000000;font-weight: bold">().</span><span style="color: #008080">toUpperCase</span><span style="color: #000000;font-weight: bold">());</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_интерфейсы_closeable_и_autocloseable"><h2>Интерфейсы Closeable и AutoCloseable</h2><div class="slide-content"><div class="imageblock"><img src="images/closeable.png" alt="closeable"></div></div></section>
<section id="_исключениядля_исключительных_случаев"><h2>Исключения&#8201;&#8212;&#8201;для исключительных случаев!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//ЧУДОВИЩНО. НЕ ДЕЛАЙТЕ ТАК</span>
<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">;</span>
  <span style="color: #000000;font-weight: bold">while</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">true</span><span style="color: #000000;font-weight: bold">)</span>
    <span style="background-color: #f8f8f8">range</span><span style="color: #000000;font-weight: bold">[</span><span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">++].</span><span style="color: #008080">climb</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">ArrayIndexOutOfBoundsException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #999988;font-style: italic">//ДЕЛАЙТЕ ТАК!!</span>
<span style="color: #000000;font-weight: bold">for</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Mountain</span> <span style="color: #990000;font-weight: bold">m:</span> <span style="background-color: #f8f8f8">range</span><span style="color: #000000;font-weight: bold">)</span>
  <span style="background-color: #f8f8f8">m</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">climb</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div></div></section>
<section id="_исключениядля_исключительных_случаев_2"><h2>Исключения&#8201;&#8212;&#8201;для исключительных случаев!</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//ЧУДОВИЩНО. НЕ ДЕЛАЙТЕ ТАК</span>
<span style="color: #000000;font-weight: bold">try</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #445588;font-weight: bold">Iterator</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">Foo</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">collection</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">iterator</span><span style="color: #000000;font-weight: bold">();</span>
  <span style="color: #000000;font-weight: bold">while</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">true</span><span style="color: #000000;font-weight: bold">)</span>
    <span style="color: #445588;font-weight: bold">Foo</span> <span style="background-color: #f8f8f8">foo</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">next</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">}</span> <span style="color: #000000;font-weight: bold">catch</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">NoSuchElementException</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #999988;font-style: italic">//ДЕЛАЙТЕ ТАК!!</span>
<span style="color: #000000;font-weight: bold">for</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Iterator</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">Foo</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">collection</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">iterator</span><span style="color: #000000;font-weight: bold">();</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">hasNext</span><span style="color: #000000;font-weight: bold">();</span> <span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">{</span>
    <span style="color: #445588;font-weight: bold">Foo</span> <span style="background-color: #f8f8f8">foo</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">next</span><span style="color: #000000;font-weight: bold">();</span>
    <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span> <span style="color: #000000;font-weight: bold">.</span>
<span style="color: #000000;font-weight: bold">}</span></code></pre></div></div></div></section>
<section id="_не_используйте_исключения_для_контроля_выполнения"><h2>Не используйте исключения для контроля выполнения</h2><div class="slide-content"><div class="ulist"><ul><li><p>Это <strong>маскирует</strong> настоящие ошибки и делает код трудным для поддержки.</p></li><li><p>Это <strong>затратно</strong> по ресурсам (исключения несут в себе Stack Trace).</p></li><li><p>Это <strong>медленно</strong>: компилятор не оптимизирует под исключения.</p></li></ul></div></div></section>
<section id="_исключение_вылезло_в_production_что_делать"><h2>Исключение вылезло в production. Что делать?</h2><div class="slide-content"><div class="literalblock"><div class="content"><pre> 2019-08-24 11:14:55.545 ERROR 30413 --- [0.1-8080-exec-6] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is java.lang.NullPointerException] with root cause
 java.lang.NullPointerException: null
at guess.service.AnswerServiceImpl.setAnswer(AnswerServiceImpl.java:37) ~[classes!/:na]
at guess.controller.AnswerController.addAnswer(AnswerController.java:31) ~[classes!/:na]
at sun.reflect.GeneratedMethodAccessor75.invoke(Unknown Source) ~[na:na]
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_222]
at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_222]
at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:104) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:892) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1039) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:942) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1005) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:908) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at javax.servlet.http.HttpServlet.service(HttpServlet.java:660) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:882) ~[spring-webmvc-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at javax.servlet.http.HttpServlet.service(HttpServlet.java:741) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) ~[tomcat-embed-websocket-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:109) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:92) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:109) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:93) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:109) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:200) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:109) ~[spring-web-5.1.8.RELEASE.jar!/:5.1.8.RELEASE]
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) ~[tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:853) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1587) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [na:1.8.0_222]
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [na:1.8.0_222]
at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) [tomcat-embed-core-9.0.21.jar!/:9.0.21]
at java.lang.Thread.run(Thread.java:748) [na:1.8.0_222]</pre></div></div></div></section>
<section id="_analyze_analyze_stack_trace"><h2>Analyze &#8594; Analyze Stack Trace&#8230;&#8203;</h2><div class="slide-content"><div class="imageblock"><img src="images/analyzestacktrace.png" alt="analyzestacktrace"></div></div></section>
<section id="_исследуем_стек_вызовов"><h2>Исследуем стек вызовов</h2><div class="slide-content"><div class="imageblock"><img src="images/stacktracereading.png" alt="stacktracereading"></div></div></section>
<section id="_здесь_мы_делаем_паузу_в_изучении_особенностей_языка_ради_изучения_библиотеки"><h2>Здесь мы делаем паузу в изучении особенностей языка ради изучения библиотеки</h2><div class="slide-content"><div class="ulist"><ul><li><p>J. Bloch, 'Effective Java': 'By using a standard library, you take advantage of the knowledge of the experts who wrote it and the experience of those who used it before you&#8230;&#8203; Numerous features are added to the libraries in every major release, and it pays to keep abreast of these additions.'</p></li><li><p>Наряду с актуальными, «свежими» классами в библиотеках есть много старых классов, оставленных для обратной совместимости.</p></li><li><p>Вы встретите <code>Vector</code>, <code>Date</code>, <code>File</code>, <code>StringBuffer</code>, <code>Random</code>, <em>о которых я не буду рассказывать на лекциях</em>.</p></li><li><p>Будьте внимательны: использование устаревших классов в существующем коде, в примерах в интернете и т. п. не оправдывает их использование в новом коде.</p></li></ul></div></div></section>
<section id="_отдельный_пример_из_книги_effective_java_threadlocalrandom"><h2>Отдельный пример из книги Effective Java: ThreadLocalRandom</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//Плохо: сид выбирается при каждом вызове. НЕТ!!</span>
<span style="color: #445588;font-weight: bold">double</span> <span style="background-color: #f8f8f8">rnd</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">Random</span><span style="color: #000000;font-weight: bold">()).</span><span style="color: #008080">nextDouble</span><span style="color: #000000;font-weight: bold">();</span>

<span style="color: #999988;font-style: italic">//До Java 7+ так было нормально, но теперь НЕТ!!</span>
<span style="color: #000000;font-weight: bold">static</span> <span style="color: #000000;font-weight: bold">final</span> <span style="color: #445588;font-weight: bold">Random</span> <span style="background-color: #f8f8f8">r</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">Random</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">double</span> <span style="color: #990000;font-weight: bold">random</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">{</span>
  <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">r</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">nextDouble</span><span style="color: #000000;font-weight: bold">();</span>
<span style="color: #000000;font-weight: bold">}</span>

<span style="color: #999988;font-style: italic">//Java 7-16: в 3.6 раз быстрее, проще, качественнее</span>
<span style="color: #445588;font-weight: bold">double</span> <span style="background-color: #f8f8f8">rnd</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #445588;font-weight: bold">ThreadLocalRandom</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">current</span><span style="color: #000000;font-weight: bold">().</span><span style="color: #008080">nextDouble</span><span style="color: #000000;font-weight: bold">();</span>

<span style="color: #999988;font-style: italic">//Java 17+: JEP356. Not thread safe!</span>
<span style="color: #445588;font-weight: bold">RandomGenerator</span> <span style="background-color: #f8f8f8">generator</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #445588;font-weight: bold">RandomGenerator</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">getDefault</span><span style="color: #000000;font-weight: bold">();</span>
<span style="background-color: #f8f8f8">generator</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">nextDouble</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div></div></section>
<section id="_класс_string"><h2>Класс String</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">""</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #999988;font-style: italic">// an empty string</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">java</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"Java\u2122"</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #999988;font-style: italic">//Java™</span></code></pre></div></div></div></section>
<section id="_строкаиммутабельный_объект"><h2>Строка&#8201;&#8212;&#8201;иммутабельный объект.</h2><div class="slide-content"><div class="paragraph"><p>Нужна другая строка? Сооружаем новую:</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">greeting</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"Hello!"</span>
<span style="background-color: #f8f8f8">greeting</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">substring</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #009999">3</span><span style="color: #000000;font-weight: bold">)</span> <span style="color: #000000;font-weight: bold">+</span> <span style="color: #d14">"p!"</span><span style="color: #000000;font-weight: bold">;</span> <span style="color: #999988;font-style: italic">//Help!</span></code></pre></div></div>
<div class="paragraph"><p>Хотя внутри строки&#8201;&#8212;&#8201;массив, изменить его отдельные элементы нельзя!</p></div></div></section>
<section id="_внутреннее_представление_строк"><h2>Внутреннее представление строк</h2><div class="slide-content"><div class="ulist"><ul><li><p>До Java 9&#8201;&#8212;&#8201;<code>char[]</code></p></li><li><p>После Java 9&#8201;&#8212;&#8201;<code>byte[]</code> и <code>byte coder</code></p></li><li><p>UTF-16 / Latin1 ('Compact Strings')</p></li><li><p><a href="https://www.youtube.com/watch?v=HWkVJkoo1_Q">Алексей Шипилёв — The Lord of the Strings: Two Scours</a></p></li></ul></div></div></section>
<section id="_пул_строковых_констант"><h2>Пул строковых констант</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:35%"><col style="width:65%"></colgroup><tbody><tr><td class="tableblock halign-left valign-middle"><div><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"John Doe"</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"John Doe"</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #999988;font-style: italic">/* DO NOT DO THIS!!*/</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name3</span>
  <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">String</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"John Doe"</span><span style="color: #000000;font-weight: bold">);</span></code></pre></div></div></div></td><td class="tableblock halign-center valign-middle"><div><div class="imageblock"><img src="images/stringpool.png.png" alt="stringpool"></div></div></td></tr></table></div></section>
<section id="_сравнение_строк"><h2>Сравнение строк</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p><code>if (a == "John Doe")</code>&#8201;&#8212;&#8201;<strong>неправильно</strong>, ошибка новичка.</p></li><li class="fragment"><p><code>if (a.equals("John Doe"))</code>&#8201;&#8212;&#8201;плохо, получим NPE, если <code>a == null</code>.</p></li><li class="fragment"><p><code>if ("John Doe".equals(a))</code>&#8201;&#8212;&#8201;так делают  серьёзные ребята.</p></li><li class="fragment"><p><code>if ("John Doe".equalsIgnoreCase(a))</code>&#8201;&#8212;&#8201;сравнение без учёта регистра.</p></li><li class="fragment"><p><code>if(str != null &amp;&amp; !str.isEmpty())</code>&#8201;&#8212;&#8201;в этой строке что-то есть!</p></li><li class="fragment"><p><code>if(str != null &amp;&amp; !str.isBlank())</code>&#8201;&#8212;&#8201;в этой строке что-то есть помимо пробелов, табуляций, переносов и проч.!</p></li></ul></div></div></section>
<section id="_интернирование_строк"><h2>Интернирование строк</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:35%"><col style="width:65%"></colgroup><tbody><tr><td class="tableblock halign-left valign-middle"><div><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"John Doe"</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name2</span> <span style="color: #000000;font-weight: bold">=</span>
  <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">String</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"John Doe"</span><span style="color: #000000;font-weight: bold">);</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">name3</span> <span style="color: #000000;font-weight: bold">=</span>
  <span style="color: #000000;font-weight: bold">new</span> <span style="color: #990000;font-weight: bold">String</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #d14">"Jane Roe"</span><span style="color: #000000;font-weight: bold">);</span></code></pre></div></div></div></td><td class="tableblock halign-center valign-middle"><div><div class="imageblock"><img src="images/stringpool-intern1.png.png" alt="stringpool intern1"></div></div></td></tr></table></div></section>
<section id="_интернирование_строк_2"><h2>Интернирование строк</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:35%"><col style="width:65%"></colgroup><tbody><tr><td class="tableblock halign-left valign-middle"><div><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="background-color: #f8f8f8">name1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">name1</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">intern</span><span style="color: #000000;font-weight: bold">();</span>
<span style="background-color: #f8f8f8">name2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">name2</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">intern</span><span style="color: #000000;font-weight: bold">();</span>
<span style="background-color: #f8f8f8">name3</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">name3</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">intern</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div></div></td><td class="tableblock halign-center valign-middle"><div><div class="imageblock"><img src="images/stringpool-intern2.png.png" alt="stringpool intern2"></div></div></td></tr></table></div></section>
<section id="_конкатенация_строк"><h2>Конкатенация строк</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">foo</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"foo"</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">bar</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"bar"</span><span style="color: #000000;font-weight: bold">;</span>

<span style="color: #445588;font-weight: bold">System</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">out</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">println</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">foo</span> <span style="color: #000000;font-weight: bold">+</span> <span style="background-color: #f8f8f8">bar</span><span style="color: #000000;font-weight: bold">);</span> <span style="color: #999988;font-style: italic">//foobar</span></code></pre></div></div>
<div class="paragraph"><p>Ситуация такова:</p></div>
<div class="ulist"><ul><li><p>Пользовательской перегрузки операторов в Java не предусмотрено.</p></li><li><p>Оператор <code>+</code> для строк перегружен на уровне языка.</p></li><li><p>Оператор <code>==</code> для строк не перегружен, хоть его неперегруженная версия для строк и не имеет смысла :-(</p></li></ul></div></div></section>
<section id="_конкатенация_строк_проблема_производительности"><h2>&#8203;Конкатенация строк: проблема производительности&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//Плохая производительность, не делайте так!</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">result</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">""</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #000000;font-weight: bold">for</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">;</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="background-color: #f8f8f8">numItems</span><span style="color: #000000;font-weight: bold">();</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">++)</span>
  <span style="background-color: #f8f8f8">result</span> <span style="color: #000000;font-weight: bold">+=</span> <span style="background-color: #f8f8f8">lineForItem</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">);</span>
<span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">result</span><span style="color: #000000;font-weight: bold">;</span></code></pre></div></div></div></section>
<section id="_конкатенация_строк_используйте_stringbuilder"><h2>&#8203;Конкатенация строк: используйте StringBuilder!&#8203;</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//Заранее можно аллоцировать приблизительное кол-во символов</span>
<span style="color: #445588;font-weight: bold">StringBuilder</span> <span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">StringBuilder</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">numItems</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #008080">LINE_WIDTH</span><span style="color: #000000;font-weight: bold">);</span>
<span style="color: #999988;font-style: italic">//А можно и по умолчанию: new StringBuilder() (16 chars)</span>
<span style="color: #000000;font-weight: bold">for</span> <span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">;</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="background-color: #f8f8f8">numItems</span><span style="color: #000000;font-weight: bold">();</span> <span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">++)</span>
  <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">append</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">lineForItem</span><span style="color: #000000;font-weight: bold">(</span><span style="background-color: #f8f8f8">i</span><span style="color: #000000;font-weight: bold">));</span>
<span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">toString</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div></div></section>
<section id="_длина_строки"><h2>Длина строки</h2><div class="slide-content"><div class="paragraph"><p>Длина строки в UTF-16 code units:</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">greeting</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">"Hello"</span><span style="color: #000000;font-weight: bold">;</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">length</span><span style="color: #000000;font-weight: bold">();</span> <span style="color: #999988;font-style: italic">// is 5.</span></code></pre></div></div>
<div class="paragraph"><p>«Реальная» длина строки в code points:</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">cpCount</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">codePointCount</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">,</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">length</span><span style="color: #000000;font-weight: bold">());</span></code></pre></div></div></div></section>
<section id="_символ_на_i_й_позиции"><h2>Символ на i-й позиции</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #999988;font-style: italic">//работает за время O(1)</span>
<span style="color: #445588;font-weight: bold">char</span> <span style="background-color: #f8f8f8">first</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">charAt</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">0</span><span style="color: #000000;font-weight: bold">);</span> <span style="color: #999988;font-style: italic">// first is 'H'</span>
<span style="color: #445588;font-weight: bold">char</span> <span style="background-color: #f8f8f8">last</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">greeting</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">charAt</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #009999">4</span><span style="color: #000000;font-weight: bold">);</span> <span style="color: #999988;font-style: italic">// last is 'o'</span></code></pre></div></div>
<div class="paragraph"><p>Если нужны code points:</p></div>
<div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">[]</span> <span style="background-color: #f8f8f8">codePoints</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">str</span><span style="color: #000000;font-weight: bold">.</span><span style="color: #008080">codePoints</span><span style="color: #000000;font-weight: bold">().</span><span style="color: #008080">toArray</span><span style="color: #000000;font-weight: bold">();</span></code></pre></div></div></div></section>
<section id="_полезные_методы"><h2>Полезные методы</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="java"><span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">length</span><span style="color: #000000;font-weight: bold">()</span>
<span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">isEmpty</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">/</span> <span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">isBlank</span><span style="color: #000000;font-weight: bold">()</span>
<span style="color: #445588;font-weight: bold">char</span> <span style="color: #990000;font-weight: bold">charAt</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">index</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">compareTo</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">anotherString</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">equals</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">Object</span> <span style="background-color: #f8f8f8">anObject</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">equalsIgnoreCase</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">anotherString</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">startsWith</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">prefix</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">boolean</span> <span style="color: #990000;font-weight: bold">endsWith</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">String</span> <span style="background-color: #f8f8f8">suffix</span><span style="color: #000000;font-weight: bold">)</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">toLowerCase</span><span style="color: #000000;font-weight: bold">()</span> <span style="color: #000000;font-weight: bold">/</span> <span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">toUpperCase</span><span style="color: #000000;font-weight: bold">()</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">trim</span><span style="color: #000000;font-weight: bold">()</span>
<span style="color: #445588;font-weight: bold">String</span> <span style="color: #990000;font-weight: bold">join</span><span style="color: #000000;font-weight: bold">(</span><span style="color: #445588;font-weight: bold">CharSequence</span> <span style="background-color: #f8f8f8">delimiter</span><span style="color: #000000;font-weight: bold">,</span> <span style="color: #445588;font-weight: bold">CharSequence</span><span style="color: #000000;font-weight: bold">...</span> <span style="background-color: #f8f8f8">elements</span><span style="color: #000000;font-weight: bold">)</span></code></pre></div></div></div></section>
<section id="_вредные_методы"><h2>Вредные методы</h2><div class="slide-content"><div class="ulist"><ul><li><p><code>indexOf..</code> / <code>lastIndexOf..</code></p></li><li><p><code>replace..</code></p></li><li><p><code>split..</code></p></li></ul></div>
<div class="paragraph"><p>В комбинации c <code>substring</code> и конкатенацией их используют для извлечения данных / преобразования строк.</p></div>
<div class="paragraph"><p><em>Не делайте так. Это путь к бесконечным багам, бесконечной боли и бесконечному стыду. Используйте конечные автоматы или регулярные выражения.</em></p></div></div></section></div></div><script src="reveal.js-3.9.2/js/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'none',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1600,
  height: 900,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true },
      { src: 'reveal.js-3.9.2/plugin/notes/notes.js', async: true }
  ],

  

});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1600, 900)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1600, 900)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1600, 900)
});</script></body></html>